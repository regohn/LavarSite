<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Daily Image Viewer</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background-color: #f2f2f7;
      margin: 0;
      padding: 20px;
      color: #1c1c1e;
    }

    h2 {
      text-align: center;
      margin-bottom: 15px;
      color: #0a84ff;
    }

    input[type="date"] {
      display: block;
      margin: 0 auto 20px auto;
      padding: 10px;
      font-size: 16px;
      border-radius: 12px;
      border: 1px solid #ccc;
    }

    .image-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 30px;
    }

    .image-grid img {
      width: 140px;
      height: 100px;
      object-fit: cover;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .image-grid img:hover {
      transform: scale(1.05);
    }

    .summary {
      margin-top: 40px;
    }

    .summary-date {
      font-weight: bold;
      margin-top: 10px;
    }

    .summary-thumbs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
    }

    .summary-thumbs img {
      width: 80px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
    }

    /* Lightbox viewer */
    .lightbox {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.9);
      justify-content: center;
      align-items: center;
      z-index: 999;
      flex-direction: column;
    }

    .lightbox img {
      max-width: 90%;
      max-height: 80%;
      border-radius: 12px;
    }

    .lightbox-controls {
      color: white;
      margin-top: 10px;
    }

    .nav-button {
      font-size: 30px;
      cursor: pointer;
      margin: 0 30px;
      user-select: none;
    }

    .close-button {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 28px;
      color: white;
      cursor: pointer;
    }

    .link-wrapper a:hover {
      background-color: #e6f0ff;
    }    
  </style>
</head>
<body>

  <h2>View Uploaded Images</h2>
    <div class="link-wrapper">
    <a href="dailyreport.html">Upload Daily Report</a>
  </div>
  <input type="date" id="datePicker" />

  <div class="image-grid" id="imageContainer"></div>

  <div class="summary" id="summaryContainer">
    <h3>Summary by Date</h3>
  </div>

  <!-- Lightbox viewer -->
  <div class="lightbox" id="lightbox">
    <span class="close-button" onclick="closeLightbox()">×</span>
    <img id="lightboxImage" src="">
    <div class="lightbox-controls">
      <span class="nav-button" onclick="prevImage()">⟨</span>
      <span class="nav-button" onclick="nextImage()">⟩</span>
    </div>
  </div>

  <script>
    const webAppURL = "https://script.google.com/macros/s/AKfycbxXPGJSr3b86WWY_lYWPivLqa_9cYFkKmjMtoEXZwd17kqZspTv_KQDNuVhBlKX5zmmQQ/exec?action=getImages";
    let allData = {};
    let currentImages = [];
    let currentIndex = 0;

    async function fetchData() {
      const res = await fetch(webAppURL);
      allData = await res.json();
      populateSummary(allData);
    }

    function populateSummary(data) {
      const container = document.getElementById("summaryContainer");
      container.innerHTML = '<h3>Summary by Date</h3>';

      Object.keys(data).sort((a, b) => new Date(b) - new Date(a)).forEach(date => {
        const div = document.createElement("div");
        div.innerHTML = `<div class="summary-date">${date}</div>`;
        const thumbWrap = document.createElement("div");
        thumbWrap.className = "summary-thumbs";
        data[date].forEach(url => {
          const img = document.createElement("img");
          img.src = url;
          thumbWrap.appendChild(img);
        });
        div.appendChild(thumbWrap);
        container.appendChild(div);
      });
    }

    function displayImages(date) {
      const container = document.getElementById("imageContainer");
      container.innerHTML = "";

      currentImages = allData[date] || [];
      currentImages.forEach((url, index) => {
        const img = document.createElement("img");
        img.src = url;
        img.onclick = () => openLightbox(index);
        container.appendChild(img);
      });
    }

    function openLightbox(index) {
      currentIndex = index;
      document.getElementById("lightbox").style.display = "flex";
      document.getElementById("lightboxImage").src = currentImages[index];
    }

    function closeLightbox() {
      document.getElementById("lightbox").style.display = "none";
    }

    function prevImage() {
      if (currentImages.length === 0) return;
      currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
      document.getElementById("lightboxImage").src = currentImages[currentIndex];
    }

    function nextImage() {
      if (currentImages.length === 0) return;
      currentIndex = (currentIndex + 1) % currentImages.length;
      document.getElementById("lightboxImage").src = currentImages[currentIndex];
    }

    document.getElementById("datePicker").addEventListener("change", e => {
      const selectedDate = e.target.value;
      displayImages(selectedDate);
    });

    fetchData();
  </script>

</body>
</html>
